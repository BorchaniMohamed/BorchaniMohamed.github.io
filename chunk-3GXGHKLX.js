import{h as et,j as it}from"./chunk-EKWSGT7S.js";import{a as X,c as J,f as K,k as U,m as Z}from"./chunk-26WEWBBF.js";import{a as Q,b as tt}from"./chunk-NQTWXL5Z.js";import{$ as w,Aa as B,Ba as D,Ga as q,I as p,Ia as Y,J as C,Q as _,S as m,U as y,W as l,X as d,Y as V,Z as v,_ as I,ba as x,ca as c,da as h,ea as A,f as P,fa as S,ga as W,ha as H,i as b,ia as F,ja as G,l as k,la as N,ma as M,na as $,o as E,oa as R,q as T,t as L,w as g,x as f,ya as j,za as z}from"./chunk-MTOAIVV6.js";var ot=(()=>{class o{http;constructor(e){this.http=e}getCrossword(e){return this.http.get(e)}static \u0275fac=function(i){return new(i||o)(E(D))};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var rt=(()=>{class o{transform(e){let i=Math.floor(e/60),t=e%60;return`${i}:${t<10?"0":""}${t}`}static \u0275fac=function(i){return new(i||o)};static \u0275pipe=L({name:"minutesSeconds",type:o,pure:!0,standalone:!0})}return o})();var st=()=>[];function lt(o,u){if(o&1&&(l(0,"span"),h(1),d()),o&2){let e=c(2).index,i=c().index,t=c();p(),S(" ",t.getClueNumber(i,e)," ")}}function at(o,u){if(o&1){let e=w();v(0),l(1,"input",11),G("ngModelChange",function(t){g(e);let n=c().index,r=c().index,a=c();return F(a.playerInputs[r][n],t)||(a.playerInputs[r][n]=t),f(t)}),x("focus",function(){g(e);let t=c().index,n=c().index,r=c();return f(r.onCellClick(n,t))})("input",function(){g(e);let t=c().index,n=c().index,r=c();return f(r.handleInput(n,t))}),d(),_(2,lt,2,1,"span",10),I()}if(o&2){let e=c().index,i=c().index,t=c();p(),y("highlight",t.isHighlighted(i,e))("incorrect",t.isWordIncorrect(i,e)),H("ngModel",t.playerInputs[i][e]),m("id","input-"+i+"-"+e),p(),m("ngIf",t.isStartingCharacter(i,e))}}function dt(o,u){if(o&1&&(l(0,"td"),_(1,at,3,7,"ng-container",10),d()),o&2){let e=u.index,i=c().index,t=c();p(),m("ngIf",t.getCharAtPosition(i,e))}}function pt(o,u){if(o&1&&(l(0,"tr"),_(1,dt,2,1,"td",4),d()),o&2){let e=c();p(),m("ngForOf",M(1,st).constructor(e.crosswordWidth))}}function ht(o,u){if(o&1){let e=w();l(0,"li",13),x("click",function(){g(e);let t=c().index,n=c();return f(n.onClueClick(t))}),h(1),d()}if(o&2){let e=c(),i=e.$implicit,t=e.index,n=c();y("highlight",n.isClueHighlighted(t)),p(),W(" ",t+1,". ",i.clue," ")}}function mt(o,u){if(o&1&&(v(0),_(1,ht,2,4,"li",12),I()),o&2){let e=u.$implicit;p(),m("ngIf",e.type==="across")}}function ut(o,u){if(o&1){let e=w();l(0,"li",13),x("click",function(){g(e);let t=c().index,n=c();return f(n.onClueClick(t))}),h(1),d()}if(o&2){let e=c(),i=e.$implicit,t=e.index,n=c();y("highlight",n.isClueHighlighted(t)),p(),W(" ",t+1,". ",i.clue," ")}}function gt(o,u){if(o&1&&(v(0),_(1,ut,2,4,"li",12),I()),o&2){let e=u.$implicit;p(),m("ngIf",e.type==="down")}}function ft(o,u){if(o&1){let e=w();l(0,"div",14),x("click",function(){g(e);let t=c();return f(t.resetGame())}),l(1,"div",15),x("click",function(t){return g(e),f(t.stopPropagation())}),l(2,"h2"),h(3,"Game Over"),d(),l(4,"p"),h(5),d(),l(6,"button",16),x("click",function(){g(e);let t=c();return f(t.resetGame())}),h(7,"Play Again"),d(),l(8,"span",17),x("click",function(){g(e);let t=c();return f(t.resetGame())}),h(9,"\xD7"),d()()()}if(o&2){let e=c();p(5),A(e.gameOverMessage)}}var At=(()=>{class o{crosswordService;toastr;route;authService;router;id;lengths=[];crosswordHeight;crosswordWidth;words=[];selectedWord=null;playerInputs=[];showErrorMessage=!1;incorrectWords=new Set;lastSelectedWord=null;lastSelectedRowIndex=null;lastSelectedColIndex=null;highlightedClueIndex=null;chancesLeft=4;timer;timeLeft=600;isGameOver=!1;gameOverMessage="";constructor(e,i,t,n,r){this.crosswordService=e,this.toastr=i,this.route=t,this.authService=n,this.router=r}get isLoggedIn(){return this.authService.isLoggedIn()}ngOnInit(){this.id=this.route.snapshot.params.id,this.isLoggedIn&&this.id&&!isNaN(Number(this.id))?this.fillCrosswordProps(`./assets/crosswords/crossword${this.id}.json`):this.router.navigate(["/home"])}initializePlayerInputs(){this.playerInputs=Array.from({length:this.crosswordHeight},()=>Array(this.crosswordWidth).fill(""))}fillCrosswordProps(e){this.crosswordService.getCrossword(e).pipe(b(i=>(i.status===404&&this.router.navigate(["/home"]),P([])))).subscribe(i=>{i.forEach(r=>{this.lengths.push(r.word.length)});let{crosswordHeight:t,crosswordWidth:n}=this.getCrosswordWidthHeight(i,this.lengths);this.crosswordHeight=t,this.crosswordWidth=n,this.words=i,this.initializePlayerInputs(),this.startTimer()})}getCrosswordWidthHeight(e,i){let t=0,n=0,r=0,a=0;for(let s=0;s<i.length;s++)e[s].type==="down"&&(e[s].posy>t?(t=e[s].posy,r=i[s]):e[s].posy===t&&r<i[s]&&(r=i[s])),e[s].type==="across"&&(e[s].posx>n?(n=e[s].posx,a=i[s]):e[s].posx===n&&a<i[s]&&(r=i[s]));return{crosswordHeight:t+r,crosswordWidth:n+a}}isStartingCharacter(e,i){return this.words.some(t=>t.posx===i&&t.posy===e)}getClueNumber(e,i){for(let t=0;t<this.words.length;t++)if(this.words[t].posx===i&&this.words[t].posy===e)return t+1;return null}getCharAtPosition(e,i){for(let t of this.words){if(t.type==="across"&&t.posy===e&&i>=t.posx&&i<t.posx+t.word.length)return t.word[i-t.posx];if(t.type==="down"&&t.posx===i&&e>=t.posy&&e<t.posy+t.word.length)return t.word[e-t.posy]}return null}onCellClick(e,i){let t=this.findWordAtPosition(e,i);t&&(t.posx===i&&t.posy===e&&t.type==="down"||t.posx===i&&t.posy===e&&t.type==="across")&&(this.lastSelectedWord=t,this.lastSelectedRowIndex=e,this.lastSelectedColIndex=i,this.highlightedClueIndex=this.words.indexOf(t)),this.highlightWord(e,i)}isClueHighlighted(e){return e===this.highlightedClueIndex}highlightWord(e,i){let t=this.findWordAtPosition(e,i);if(t){this.clearAllHighlights();for(let n=0;n<t.word.length;n++){let r=e,a=i;t.type==="across"?a=t.posx+n:t.type==="down"&&(r=t.posy+n);let s=document.getElementById(`input-${r}-${a}`);s&&s.classList.add("highlight")}}}clearAllHighlights(){document.querySelectorAll("input").forEach(i=>{i.classList.remove("highlight"),i.classList.remove("incorrect")})}isHighlighted(e,i){return this.selectedWord?this.selectedWord.type==="across"?this.selectedWord.posy===e&&i>=this.selectedWord.posx&&i<this.selectedWord.posx+this.selectedWord.word.length:this.selectedWord.type==="down"?this.selectedWord.posx===i&&e>=this.selectedWord.posy&&e<this.selectedWord.posy+this.selectedWord.word.length:!1:!1}checkAnswers(){let e=!1;this.incorrectWords.clear(),this.words.forEach((i,t)=>{this.isWordCorrect(i)||(e=!0,this.incorrectWords.add(t))}),e?(this.showErrorMessage=!0,setTimeout(()=>{this.showErrorMessage=!1},5e3)):alert("Congratulations! All words are correct!")}isWordCorrect(e){let i=!0;for(let t=0;t<e.word.length;t++){let n=e.posy+(e.type==="down"?t:0),r=e.posx+(e.type==="across"?t:0),a=this.playerInputs[n][r]?.toLowerCase(),s=e.word[t].toLowerCase();a!==s&&(i=!1)}return i}isWordIncorrect(e,i){return this.words.some((t,n)=>{if(this.incorrectWords.has(n))for(let r=0;r<t.word.length;r++){let a=t.posy+(t.type==="down"?r:0),s=t.posx+(t.type==="across"?r:0);if(a===e&&s===i)return!0}return!1})}moveFocusToNext(e,i){if(!this.lastSelectedWord||this.lastSelectedRowIndex===null||this.lastSelectedColIndex===null)return;let t=this.lastSelectedWord,r=(t.type==="across"?i-t.posx:e-t.posy)+1,a=e,s=i;if(t.type==="across"?s=i+1:t.type==="down"&&(a=e+1),r<t.word.length){let O=document.getElementById(`input-${a}-${s}`);O&&O.focus()}}findWordAtPosition(e,i){return this.words.find(n=>n.posx===i&&n.posy===e)||null||this.words.find(n=>n.type==="across"?n.posy===e&&i>=n.posx&&i<n.posx+n.word.length:n.type==="down"?n.posx===i&&e>=n.posy&&e<n.posy+n.word.length:!1)||null}handleInput(e,i){this.findWordAtPosition(e,i)&&this.moveFocusToNext(e,i)}startTimer(){this.timer=setInterval(()=>{this.timeLeft>0?this.timeLeft--:this.endGame("Time's up!")},1e3)}checkWords(){this.isGameOver||this.chancesLeft>0&&(this.chancesLeft--,this.highlightIncorrectWords(),this.toastr.warning("V\xE9rifie tes erreurs!","Quelques mots sont incorrects"),this.chancesLeft===0&&this.endGame("Vous n'avez aucune autre chance!"))}endGame(e){this.isGameOver=!0,this.gameOverMessage=e,clearInterval(this.timer),this.toastr.error(e,"Game Over")}resetGame(){this.chancesLeft=4,this.timeLeft=600,this.isGameOver=!1,this.gameOverMessage="",this.playerInputs=Array.from({length:this.crosswordHeight},()=>Array(this.crosswordWidth).fill("")),this.clearAllHighlights(),clearInterval(this.timer),this.startTimer()}highlightIncorrectWords(){let e=!0;this.words.forEach(i=>{let t=!0;for(let n=0;n<i.word.length;n++){let r=i.posy,a=i.posx;i.type==="across"?a+=n:i.type==="down"&&(r+=n);let s=document.getElementById(`input-${r}-${a}`);s&&s.value.toLowerCase()!==i.word[n].toLowerCase()?(s.classList.add("incorrect"),t=!1):s.classList.remove("incorrect")}t||(e=!1)}),e&&this.endGame("Congratulations! You completed the crossword.")}onClueClick(e){let i=this.words[e];this.highlightedClueIndex=e,this.highlightWordByWord(i)}highlightWordByWord(e){let{posx:i,posy:t,type:n}=e;if(n==="across")for(let r=0;r<e.word.length;r++)this.highlightWord(t,i+r);else if(n==="down")for(let r=0;r<e.word.length;r++)this.highlightWord(t+r,i)}static \u0275fac=function(i){return new(i||o)(C(ot),C(et),C(q),C(Q),C(Y))};static \u0275cmp=T({type:o,selectors:[["app-crossword"]],standalone:!0,features:[N],decls:26,vars:10,consts:[[1,"crossword-space"],[1,"game-controls"],[3,"click","disabled"],["id","crossword"],[4,"ngFor","ngForOf"],[1,"clues-container"],[1,"across-clues"],[1,"no-bullets"],[1,"down-clues"],["class","modal-overlay",3,"click",4,"ngIf"],[4,"ngIf"],["type","text","maxlength","1",3,"ngModelChange","focus","input","ngModel","id"],["class","clue",3,"highlight","click",4,"ngIf"],[1,"clue",3,"click"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"click"],[1,"close-modal",3,"click"]],template:function(i,t){i&1&&(V(0,"app-header"),l(1,"div",0)(2,"div",1)(3,"p"),h(4),d(),l(5,"button",2),x("click",function(){return t.checkWords()}),h(6,"Check Words"),d(),l(7,"p"),h(8),$(9,"minutesSeconds"),d()(),l(10,"div",3)(11,"table")(12,"tbody"),_(13,pt,2,2,"tr",4),d()()(),l(14,"div",5)(15,"div",6)(16,"h3"),h(17,"Across clues"),d(),l(18,"ul",7),_(19,mt,2,1,"ng-container",4),d()(),l(20,"div",8)(21,"h3"),h(22,"Down clues"),d(),l(23,"ul",7),_(24,gt,2,1,"ng-container",4),d()()()(),_(25,ft,10,1,"div",9)),i&2&&(p(4),S("Chances Left: ",t.chancesLeft,""),p(),m("disabled",t.isGameOver),p(3),S("Time Left: ",R(9,7,t.timeLeft),""),p(5),m("ngForOf",M(9,st).constructor(t.crosswordHeight)),p(6),m("ngForOf",t.words),p(5),m("ngForOf",t.words),p(),m("ngIf",t.isGameOver))},dependencies:[B,j,z,Z,X,J,U,K,rt,it,tt],styles:["table[_ngcontent-%COMP%]{border-collapse:collapse;margin:20px auto;box-shadow:0 4px 8px #0000001a}td[_ngcontent-%COMP%]{width:40px;height:40px;border:2px solid #333;text-align:center;vertical-align:middle;font-family:Courier New,Courier,monospace;background-color:#f9f9f9;position:relative}td[_ngcontent-%COMP%]:empty{background-color:#3330;border:0px}td[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}td[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7rem;position:absolute;top:2px;left:4px;color:#999}input[_ngcontent-%COMP%]{text-align:center;font-size:20px;border:1px solid #000;width:40px;height:40px;margin:0;padding:0}input[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.error-message[_ngcontent-%COMP%]{color:red;font-weight:700;margin-top:10px}.highlight[_ngcontent-%COMP%]{background-color:#ffc}input.incorrect[_ngcontent-%COMP%]{background-color:#fcc}input.highlight[_ngcontent-%COMP%]{background-color:#ffc}.crossword-space[_ngcontent-%COMP%]{margin-top:5px;border:1px solid blueviolet;border-radius:30px}.game-controls[_ngcontent-%COMP%]{max-width:fit-content;margin:20px auto;display:flex;column-gap:30px}.clues-container[_ngcontent-%COMP%]{width:80%;max-width:fit-content;margin-left:auto;margin-right:auto;display:flex;column-gap:100px}ul.no-bullets[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}.clue[_ngcontent-%COMP%]{margin:10px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:8px;text-align:center;max-width:400px;width:100%;box-shadow:0 5px 15px #e3f2fde3}.modal-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;font-size:1.8rem;color:#333}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;color:#555;margin:1rem 0}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;font-size:1rem;cursor:pointer;border-radius:5px}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-overlay[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}.close-modal[_ngcontent-%COMP%]{position:absolute;top:10px;right:15px;font-size:24px;cursor:pointer}"]})}return o})();export{At as CrosswordComponent};
